{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\neman\\\\OneDrive\\\\Radna povr\\u0161ina\\\\isa projekat\\\\ISA-projekat\\\\ISA-front\\\\src\\\\Components\\\\LoginPage.js\";\nimport Header from './Header';\nimport React, { Component } from \"react\";\nimport Axios from \"axios\";\nimport { Redirect } from \"react-router-dom\";\nimport ChangePasswordModal from './Modal/ChangePasswordModal';\nimport GetAuthorisation from '../Funciton/GetAuthorisation';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass LoginPage extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      errorHeader: \"\",\n      errorMessage: \"\",\n      hiddenErrorAlert: true,\n      email: \"\",\n      password: \"\",\n      redirect: false,\n      emailError: \"none\",\n      passwordError: \"none\",\n      openPasswordModal: false,\n      oldPasswordEmptyError: \"none\",\n      newPasswordEmptyError: \"none\",\n      newPasswordRetypeEmptyError: \"none\",\n      newPasswordRetypeNotSameError: \"none\",\n      errorPasswordHeader: \"\",\n      errorPasswordMessage: \"\",\n      hiddenPasswordErrorAlert: true\n    };\n\n    this.handleEmailChange = event => {\n      this.setState({\n        email: event.target.value\n      });\n    };\n\n    this.handlePasswordChange = event => {\n      this.setState({\n        password: event.target.value\n      });\n    };\n\n    this.handleLogin = () => {\n      this.setState({\n        hiddenErrorAlert: true,\n        emailError: \"none\",\n        passwordError: \"none\"\n      });\n\n      if (this.validateForm()) {\n        let loginDTO = {\n          username: this.state.email,\n          password: this.state.password\n        };\n        console.log(loginDTO);\n        Axios.post(\"/auth/login\", loginDTO, {\n          validateStatus: () => true\n        }).then(res => {\n          if (res.status === 401) {\n            this.setState({\n              errorHeader: \"Bad credentials!\",\n              errorMessage: \"Wrong username or password.\",\n              hiddenErrorAlert: false\n            });\n          } else if (res.status === 500) {\n            this.setState({\n              errorHeader: \"Internal server error!\",\n              errorMessage: \"Server error.\",\n              hiddenErrorAlert: false\n            });\n          } else if (res.status === 302) {\n            this.setState({\n              openPasswordModal: true\n            });\n          } else {\n            console.log(res.data);\n            localStorage.setItem(\"keyToken\", res.data.accessToken);\n            localStorage.setItem(\"keyRole\", JSON.stringify(res.data.roles));\n            localStorage.setItem(\"expireTime\", new Date(new Date().getTime() + res.data.expiresIn).getTime());\n\n            if (JSON.stringify(res.data.roles) === '[\"ROLE_PHARMACYADMIN\"]') {\n              Axios.get(\"/api/users/get-pharmacyid-for-admin\", {\n                headers: {\n                  Authorization: GetAuthorisation()\n                }\n              }).then(response => {\n                localStorage.setItem(\"keyPharmacyId\", response.data);\n              }).catch(err => {\n                console.log(err);\n              });\n            }\n\n            this.setState({\n              redirect: true\n            });\n          }\n        }).catch(err => {\n          console.log(err);\n        });\n      }\n    };\n\n    this.validateForm = () => {\n      if (this.state.email === \"\") {\n        this.setState({\n          emailError: \"inline\"\n        });\n        return false;\n      } else if (this.state.password === \"\") {\n        this.setState({\n          passwordError: \"inline\"\n        });\n        return false;\n      }\n\n      return true;\n    };\n\n    this.handleCloseAlert = () => {\n      this.setState({\n        hiddenErrorAlert: true\n      });\n    };\n\n    this.handlePasswordModalClose = () => {\n      this.setState({\n        openPasswordModal: false\n      });\n    };\n\n    this.handleCloseAlertPassword = () => {\n      this.setState({\n        hiddenPasswordErrorAlert: true\n      });\n    };\n\n    this.changePassword = (oldPassword, newPassword, newPasswordRetype) => {\n      console.log(oldPassword, newPassword, newPasswordRetype);\n      this.setState({\n        hiddenPasswordErrorAlert: true,\n        errorPasswordHeader: \"\",\n        errorPasswordMessage: \"\",\n        hiddenEditInfo: true,\n        oldPasswordEmptyError: \"none\",\n        newPasswordEmptyError: \"none\",\n        newPasswordRetypeEmptyError: \"none\",\n        newPasswordRetypeNotSameError: \"none\",\n        hiddenSuccessAlert: true,\n        successHeader: \"\",\n        successMessage: \"\"\n      });\n\n      if (oldPassword === \"\") {\n        this.setState({\n          oldPasswordEmptyError: \"initial\"\n        });\n      } else if (newPassword === \"\") {\n        this.setState({\n          newPasswordEmptyError: \"initial\"\n        });\n      } else if (newPasswordRetype === \"\") {\n        this.setState({\n          newPasswordRetypeEmptyError: \"initial\"\n        });\n      } else if (newPasswordRetype !== newPassword) {\n        this.setState({\n          newPasswordRetypeNotSameError: \"initial\"\n        });\n      } else {\n        let passwordChangeDTO = {\n          oldPassword,\n          newPassword\n        };\n        Axios.post(\"/auth/change-first-password\", passwordChangeDTO, {\n          validateStatus: () => true\n        }).then(res => {\n          if (res.status === 403) {\n            this.setState({\n              hiddenPasswordErrorAlert: false,\n              errorPasswordHeader: \"Bad credentials\",\n              errorPasswordMessage: \"You entered wrong password.\"\n            });\n          } else if (res.status === 400) {\n            this.setState({\n              hiddenPasswordErrorAlert: false,\n              errorPasswordHeader: \"Invalid new password\",\n              errorPasswordMessage: \"Invalid new password.\"\n            });\n          } else if (res.status === 500) {\n            this.setState({\n              hiddenPasswordErrorAlert: false,\n              errorPasswordHeader: \"Internal server error\",\n              errorPasswordMessage: \"Server error.\"\n            });\n          } else if (res.status === 204) {\n            this.setState({\n              hiddenSuccessAlert: false,\n              successHeader: \"Success\",\n              successMessage: \"You successfully changed your password.\",\n              openPasswordModal: false\n            });\n          }\n\n          console.log(res);\n        }).catch(err => {\n          console.log(err);\n        });\n      }\n    };\n  }\n\n  render() {\n    if (this.state.redirect) return /*#__PURE__*/_jsxDEV(Redirect, {\n      push: true,\n      to: \"/\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 167,\n      columnNumber: 41\n    }, this);\n    return /*#__PURE__*/_jsxDEV(React.Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"h5\", {\n        className: \" text-center  mb-0 text-uppercase\",\n        style: {\n          marginTop: \"2rem\"\n        },\n        children: \"Login to Health Clinic\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 16\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        class: \"container\",\n        style: {\n          maxWidth: \"40%\"\n        },\n        children: /*#__PURE__*/_jsxDEV(\"form\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              style: {\n                textAlign: \"start !important\"\n              },\n              for: \"exampleInputEmail1\",\n              children: \"Email address\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 181,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"text\",\n              onChange: this.handleEmailChange,\n              value: this.state.email,\n              class: \"form-control\",\n              id: \"emailAddress\",\n              \"aria-describedby\": \"emailHelp\",\n              placeholder: \"Email address\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 182,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"form-group\",\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              for: \"exampleInputPassword1\",\n              children: \"Password\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 25\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"Password\",\n              onChange: this.handlePasswordChange,\n              value: this.state.name,\n              class: \"form-control\",\n              id: \"password\",\n              placeholder: \"Password\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 186,\n              columnNumber: 25\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            class: \"text-center\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              class: \"btn btn-primary \",\n              style: {\n                width: \"20%\"\n              },\n              onClick: this.handleLogin,\n              children: \"Submit\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 191,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 190,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 17\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 16\n      }, this), /*#__PURE__*/_jsxDEV(ChangePasswordModal, {\n        handleCloseAlertPassword: this.handleCloseAlertPassword,\n        hiddenPasswordErrorAlert: this.state.hiddenPasswordErrorAlert,\n        errorPasswordHeader: this.state.errorPasswordHeader,\n        errorPasswordMessage: this.state.errorPasswordMessage,\n        oldPasswordEmptyError: this.state.oldPasswordEmptyError,\n        newPasswordEmptyError: this.state.newPasswordEmptyError,\n        newPasswordRetypeEmptyError: this.state.newPasswordRetypeEmptyError,\n        newPasswordRetypeNotSameError: this.state.newPasswordRetypeNotSameError,\n        show: this.state.openPasswordModal,\n        changePassword: this.changePassword,\n        onCloseModal: this.handlePasswordModalClose,\n        header: \"Change password\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 200,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default LoginPage;","map":{"version":3,"sources":["C:/Users/neman/OneDrive/Radna povrÅ¡ina/isa projekat/ISA-projekat/ISA-front/src/Components/LoginPage.js"],"names":["Header","React","Component","Axios","Redirect","ChangePasswordModal","GetAuthorisation","LoginPage","state","errorHeader","errorMessage","hiddenErrorAlert","email","password","redirect","emailError","passwordError","openPasswordModal","oldPasswordEmptyError","newPasswordEmptyError","newPasswordRetypeEmptyError","newPasswordRetypeNotSameError","errorPasswordHeader","errorPasswordMessage","hiddenPasswordErrorAlert","handleEmailChange","event","setState","target","value","handlePasswordChange","handleLogin","validateForm","loginDTO","username","console","log","post","validateStatus","then","res","status","data","localStorage","setItem","accessToken","JSON","stringify","roles","Date","getTime","expiresIn","get","headers","Authorization","response","catch","err","handleCloseAlert","handlePasswordModalClose","handleCloseAlertPassword","changePassword","oldPassword","newPassword","newPasswordRetype","hiddenEditInfo","hiddenSuccessAlert","successHeader","successMessage","passwordChangeDTO","render","marginTop","maxWidth","textAlign","name","width"],"mappings":"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","sourcesContent":["import Header from './Header';\r\nimport React, { Component } from \"react\";\r\nimport Axios from \"axios\";\r\nimport { Redirect } from \"react-router-dom\";\r\nimport ChangePasswordModal from './Modal/ChangePasswordModal';\r\nimport GetAuthorisation from '../Funciton/GetAuthorisation';\r\n\r\nclass LoginPage extends Component {\r\n\r\n    state = {\r\n\t\terrorHeader: \"\",\r\n\t\terrorMessage: \"\",\r\n\t\thiddenErrorAlert: true,\r\n\t\temail: \"\",\r\n\t\tpassword: \"\",\r\n\t\tredirect: false,\r\n\t\temailError: \"none\",\r\n\t\tpasswordError: \"none\",\r\n\t\topenPasswordModal: false,\r\n\t\toldPasswordEmptyError: \"none\",\r\n\t\tnewPasswordEmptyError: \"none\",\r\n\t\tnewPasswordRetypeEmptyError: \"none\",\r\n\t\tnewPasswordRetypeNotSameError: \"none\",\r\n\t\terrorPasswordHeader: \"\",\r\n\t\terrorPasswordMessage: \"\",\r\n\t\thiddenPasswordErrorAlert: true\r\n\t};\r\n\thandleEmailChange = (event) => {\r\n\t\tthis.setState({ email: event.target.value });\r\n\t};\r\n\thandlePasswordChange = (event) => {\r\n\t\tthis.setState({ password: event.target.value });\r\n\t};\r\n\r\n\thandleLogin = () => {\r\n\t\tthis.setState({ hiddenErrorAlert: true, emailError: \"none\", passwordError: \"none\" });\r\n\r\n\t\tif (this.validateForm()) {\r\n\t\t\tlet loginDTO = { username: this.state.email, password: this.state.password };\r\n\t\t\tconsole.log(loginDTO);\r\n\t\t\tAxios.post(\"/auth/login\", loginDTO, { validateStatus: () => true })\r\n\t\t\t\t.then((res) => {\r\n\t\t\t\t\tif (res.status === 401) {\r\n\t\t\t\t\t\tthis.setState({ errorHeader: \"Bad credentials!\", errorMessage: \"Wrong username or password.\", hiddenErrorAlert: false });\r\n\t\t\t\t\t} else if (res.status === 500) {\r\n\t\t\t\t\t\tthis.setState({ errorHeader: \"Internal server error!\", errorMessage: \"Server error.\", hiddenErrorAlert: false });\r\n\t\t\t\t\t} else if (res.status === 302) {\r\n\t\t\t\t\t\tthis.setState({ openPasswordModal: true });\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tconsole.log(res.data);\r\n\t\t\t\t\t\tlocalStorage.setItem(\"keyToken\", res.data.accessToken);\r\n\t\t\t\t\t\tlocalStorage.setItem(\"keyRole\", JSON.stringify(res.data.roles));\r\n\t\t\t\t\t\tlocalStorage.setItem(\"expireTime\", new Date(new Date().getTime() + res.data.expiresIn).getTime());\r\n\r\n\t\t\t\t\t\tif (JSON.stringify(res.data.roles) === '[\"ROLE_PHARMACYADMIN\"]') {\r\n\t\t\t\t\t\t\tAxios.get(\"/api/users/get-pharmacyid-for-admin\", {\r\n\t\t\t\t\t\t\t\theaders: {\r\n\t\t\t\t\t\t\t\t\tAuthorization: GetAuthorisation(),\r\n\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.then((response) => {\r\n\t\t\t\t\t\t\t\t\tlocalStorage.setItem(\"keyPharmacyId\", response.data);\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.catch((err) => {\r\n\t\t\t\t\t\t\t\t\tconsole.log(err);\r\n\t\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.setState({ redirect: true });\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t\t.catch ((err) => {\r\n\t\t\tconsole.log(err);\r\n\t\t});\r\n\t}\r\n};\r\n\r\nvalidateForm = () => {\r\n\tif (this.state.email === \"\") {\r\n\t\tthis.setState({ emailError: \"inline\" });\r\n\t\treturn false;\r\n\t} else if (this.state.password === \"\") {\r\n\t\tthis.setState({ passwordError: \"inline\" });\r\n\t\treturn false;\r\n\t}\r\n\r\n\treturn true;\r\n};\r\n\r\nhandleCloseAlert = () => {\r\n\tthis.setState({ hiddenErrorAlert: true });\r\n};\r\n\r\nhandlePasswordModalClose = () => {\r\n\tthis.setState({ openPasswordModal: false });\r\n};\r\n\r\nhandleCloseAlertPassword = () => {\r\n\tthis.setState({ hiddenPasswordErrorAlert: true });\r\n};\r\n\r\nchangePassword = (oldPassword, newPassword, newPasswordRetype) => {\r\n\tconsole.log(oldPassword, newPassword, newPasswordRetype);\r\n\r\n\tthis.setState({\r\n\t\thiddenPasswordErrorAlert: true,\r\n\t\terrorPasswordHeader: \"\",\r\n\t\terrorPasswordMessage: \"\",\r\n\t\thiddenEditInfo: true,\r\n\t\toldPasswordEmptyError: \"none\",\r\n\t\tnewPasswordEmptyError: \"none\",\r\n\t\tnewPasswordRetypeEmptyError: \"none\",\r\n\t\tnewPasswordRetypeNotSameError: \"none\",\r\n\t\thiddenSuccessAlert: true,\r\n\t\tsuccessHeader: \"\",\r\n\t\tsuccessMessage: \"\",\r\n\t});\r\n\r\n\tif (oldPassword === \"\") {\r\n\t\tthis.setState({ oldPasswordEmptyError: \"initial\" });\r\n\t} else if (newPassword === \"\") {\r\n\t\tthis.setState({ newPasswordEmptyError: \"initial\" });\r\n\t} else if (newPasswordRetype === \"\") {\r\n\t\tthis.setState({ newPasswordRetypeEmptyError: \"initial\" });\r\n\t} else if (newPasswordRetype !== newPassword) {\r\n\t\tthis.setState({ newPasswordRetypeNotSameError: \"initial\" });\r\n\t} else {\r\n\t\tlet passwordChangeDTO = { oldPassword, newPassword };\r\n\t\tAxios.post(\"/auth/change-first-password\", passwordChangeDTO, {\r\n\t\t\tvalidateStatus: () => true\r\n\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res.status === 403) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\thiddenPasswordErrorAlert: false,\r\n\t\t\t\t\t\terrorPasswordHeader: \"Bad credentials\",\r\n\t\t\t\t\t\terrorPasswordMessage: \"You entered wrong password.\",\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (res.status === 400) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\thiddenPasswordErrorAlert: false,\r\n\t\t\t\t\t\terrorPasswordHeader: \"Invalid new password\",\r\n\t\t\t\t\t\terrorPasswordMessage: \"Invalid new password.\",\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (res.status === 500) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\thiddenPasswordErrorAlert: false,\r\n\t\t\t\t\t\terrorPasswordHeader: \"Internal server error\",\r\n\t\t\t\t\t\terrorPasswordMessage: \"Server error.\",\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (res.status === 204) {\r\n\t\t\t\t\tthis.setState({\r\n\t\t\t\t\t\thiddenSuccessAlert: false,\r\n\t\t\t\t\t\tsuccessHeader: \"Success\",\r\n\t\t\t\t\t\tsuccessMessage: \"You successfully changed your password.\",\r\n\t\t\t\t\t\topenPasswordModal: false,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tconsole.log(res);\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tconsole.log(err);\r\n\t\t\t});\r\n\t}\r\n};\r\n\r\n    render() {\r\n        if (this.state.redirect) return <Redirect push to=\"/\" />;\r\n        return(\r\n            <React.Fragment>\r\n                <Header/> \r\n\r\n                <h5 className=\" text-center  mb-0 text-uppercase\" style={{ marginTop: \"2rem\" }}>\r\n\t\t\t\t\t\tLogin to Health Clinic\r\n\t\t\t\t</h5>\r\n\r\n               <br/>  \r\n\r\n               <div class=\"container\" style={{maxWidth: \"40%\"}}>\r\n                <form>\r\n                    <div class=\"form-group\">\r\n                        <label style={{textAlign:\"start !important\"}} for=\"exampleInputEmail1\">Email address</label>\r\n                        <input type=\"text\" onChange={this.handleEmailChange} value={this.state.email} class=\"form-control\" id=\"emailAddress\" aria-describedby=\"emailHelp\" placeholder=\"Email address\"/>\r\n                    </div>\r\n                    <div class=\"form-group\">\r\n                        <label for=\"exampleInputPassword1\">Password</label>\r\n                        <input type=\"Password\" onChange={this.handlePasswordChange} value={this.state.name} class=\"form-control\" id=\"password\" placeholder=\"Password\"/>\r\n                    </div>\r\n                    \r\n                    \r\n                    <div class=\"text-center\">\r\n                    <button type=\"button\" class=\"btn btn-primary \" style={{width: \"20%\"}} onClick={this.handleLogin} >Submit</button>\r\n                    </div>\r\n\r\n                </form>\r\n            </div>   \r\n\r\n\r\n\r\n\r\n            <ChangePasswordModal\r\n\t\t\t\thandleCloseAlertPassword={this.handleCloseAlertPassword}\r\n\t\t\t\thiddenPasswordErrorAlert={this.state.hiddenPasswordErrorAlert}\r\n\t\t\t\terrorPasswordHeader={this.state.errorPasswordHeader}\r\n\t\t\t\terrorPasswordMessage={this.state.errorPasswordMessage}\r\n\t\t\t\toldPasswordEmptyError={this.state.oldPasswordEmptyError}\r\n\t\t\t\tnewPasswordEmptyError={this.state.newPasswordEmptyError}\r\n\t\t\t\tnewPasswordRetypeEmptyError={this.state.newPasswordRetypeEmptyError}\r\n\t\t\t\tnewPasswordRetypeNotSameError={this.state.newPasswordRetypeNotSameError}\r\n\t\t\t\tshow={this.state.openPasswordModal}\r\n\t\t\t\tchangePassword={this.changePassword}\r\n\t\t\t\tonCloseModal={this.handlePasswordModalClose}\r\n\t\t\t\theader=\"Change password\"\r\n\t\t\t/>\r\n            </React.Fragment>\r\n        );\r\n    }\r\n}\r\nexport default LoginPage;"]},"metadata":{},"sourceType":"module"}